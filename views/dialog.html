<imposter-l>
  <dialog open>
    <cover-l centered="[primary-element]" minHeight="100%" noPad=true space=0>
      <header>
        <box-l padding="var(--s-xs)" borderWidth=0>
          <grid-with-sidebars-l>
            <h3><%= it.task.filePath %></h3>

            <form method="get" action="/">
              <button type="submit">
                <span>Close</span>
              </button>
            </form>
          </grid-with-sidebars-l>
        </box-l>
      </header>

      <box-l primary-element padding="var(--s-xs)" borderWidth=0>
        <!--<div><%~ it.task.content %></div>-->
        <textarea name="content" id="content" form="updateForm"><%= it.task.rawContents %></textarea>
      </box-l>

      <footer>
        <box-l padding="var(--s-xs)" borderWidth=0>
          <sidebar-l side=right>
            <form id="updateForm" method="post" action="<%= it.task.actions.update %>">
              <sidebar-l side=right>
                <select aria-label="lane" id="lane" name="lane">
                  <% it.lanes.forEach(lane => { %>
                  <option value="<%= lane[0] %>" <% if (it.task.lane === lane[0]) { %>selected<% } %>>
                  <%= lane[1] %>
                  </option>
                  <% }) %>
                </select>

                <button type="submit">Save</button>
              </sidebar-l>
            </form>

            <% if (it.task.tags.length > 0) { %>
              <div>
                <ul>
                  <% it.task.tags.forEach(tag => { %>
                    <li><%= tag %></li>
                  <% }) %>
                </ul>
              </div>
            <% } %>
          </sidebar-l>
        </box-l>
      </footer>
    </cover-l>
  </dialog>
</imposter-l>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const dialog = document.querySelector('dialog');
		dialog.removeAttribute('open');

		dialog.showModal();

		dialog.addEventListener('click', ({ target }) => {
			target === dialog && dialog.close();
			window.history.replaceState({}, '', '/');
		});
	});
</script>
